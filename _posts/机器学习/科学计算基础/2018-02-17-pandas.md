---
layout: post
title:  "科学计算9 - Pandas - DataFrame"
categories: 科学计算
tags:  Pandas
author: Geng
---

* content
{:toc}

DataFrame 是表示型的数据结构，每一行就是一个记录，每一列是一个变量。简单说，DataFrame 是共享同一个 index 的 Series 集合。





## 创建 DataFrame

### 纯手工操作1
要创建，必须先创建索引，而且DataFrame 必须有索引。


```python
import pandas as pd
import numpy as np
```


```python
dates = pd.date_range('2011-1-1', periods=6, freq='D')
dates
```




    DatetimeIndex(['2011-01-01', '2011-01-02', '2011-01-03', '2011-01-04',
                   '2011-01-05', '2011-01-06'],
                  dtype='datetime64[ns]', freq='D')



用这个创建好的 dates 作为索引，创建 DataFrame：


```python
df = pd.DataFrame(np.random.randn(6, 4), index=dates, columns=list('ABCD'))
df
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>



### 纯手工操作2


```python
df1 = pd.DataFrame({'A':[1, 2, 3], 'B':[4, 5, 6], 'C':[7, 8, 9]}, 
                  index=pd.date_range('20110101', periods=3))
df1
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>1</td>
      <td>4</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>2</td>
      <td>5</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>3</td>
      <td>6</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>



### 从外部文件或者数据库导入
一般使用 `DataFrame`不会手工创建的, 都是导入的, 不过导入很简单了, 比如从 **csv** 导入:

```python
df = pandas.read_csv('csvfile.txt')
```

## 查看和操作

### 查看列名, 索引, 值和统计量


```python
df.columns
```




    Index(['A', 'B', 'C', 'D'], dtype='object')




```python
df.index
```




    DatetimeIndex(['2011-01-01', '2011-01-02', '2011-01-03', '2011-01-04',
                   '2011-01-05', '2011-01-06'],
                  dtype='datetime64[ns]', freq='D')




```python
df.values
```




    array([[-0.66012233, -1.3129909 ,  0.84327428,  3.96020219],
           [ 0.48393364,  0.39004968,  1.38578819, -0.38039762],
           [-0.85551546, -0.57764636,  0.90005938,  0.13927364],
           [-0.13578653,  1.03186187,  1.47734054, -1.11916714],
           [-0.99127477, -0.56881698, -0.64527863,  0.31228982],
           [ 2.43062939,  0.07037805,  0.3527228 ,  0.16526828]])




```python
df.describe()
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-0.092473</td>
      <td>0.280178</td>
      <td>-0.684536</td>
      <td>0.297170</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.536510</td>
      <td>0.888420</td>
      <td>1.062205</td>
      <td>1.049473</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-0.720014</td>
      <td>-1.442339</td>
      <td>-2.514868</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.569908</td>
      <td>0.270064</td>
      <td>-1.048116</td>
      <td>-0.523770</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.002167</td>
      <td>0.577708</td>
      <td>-0.480265</td>
      <td>0.183566</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.378883</td>
      <td>0.718902</td>
      <td>0.081548</td>
      <td>0.634094</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.416989</td>
      <td>1.034505</td>
      <td>0.336762</td>
      <td>2.096034</td>
    </tr>
  </tbody>
</table>
</div>



### 行列操作

#### 行


```python
df[0:3]
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
  </tbody>
</table>
</div>



#### 列


```python
df['A']
```




    2011-01-01    0.416989
    2011-01-02    0.334617
    2011-01-03    0.393638
    2011-01-04   -0.720014
    2011-01-05   -0.330284
    2011-01-06   -0.649782
    Freq: D, Name: A, dtype: float64




```python
df.A
```




    2011-01-01    0.416989
    2011-01-02    0.334617
    2011-01-03    0.393638
    2011-01-04   -0.720014
    2011-01-05   -0.330284
    2011-01-06   -0.649782
    Freq: D, Name: A, dtype: float64




```python
df[['A', 'C']]
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>-2.514868</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>-0.536929</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>0.249931</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>-1.218512</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-0.423601</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.336762</td>
    </tr>
  </tbody>
</table>
</div>



#### 条件提取


```python
df[df['A'] > 0]
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
  </tbody>
</table>
</div>




```python
df[df['A'] > 0][['A', 'C']]
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>-2.514868</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>-0.536929</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>0.249931</td>
    </tr>
  </tbody>
</table>
</div>



#### 不能这样同时提取行列

~~`df[0:1, 'A']`~~

#### 使用 loc() 方法 -- 开始变得像 matlab 的操作1
通过行列的**标签名**提取


```python
df.loc[:, 'A']  # 所有行, A 列
```




    2011-01-01    0.416989
    2011-01-02    0.334617
    2011-01-03    0.393638
    2011-01-04   -0.720014
    2011-01-05   -0.330284
    2011-01-06   -0.649782
    Freq: D, Name: A, dtype: float64




```python
df.loc[dates[0:2], 'A':'C']
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
    </tr>
  </tbody>
</table>
</div>



这样还是不行:
~~`df.loc[0:2, 'A':'C']`~~

#### 使用 iloc() -- 开始变得像 matlab 的操作2
通过行列**位置**提取(index locate)


```python
df.iloc[2]  # 提取某行
```




    A   -0.855515
    B   -0.577646
    C    0.900059
    D    0.139274
    Name: 2011-01-03 00:00:00, dtype: float64




```python
df.iloc[:, 2]  # 提取某列
```




    2011-01-01    0.843274
    2011-01-02    1.385788
    2011-01-03    0.900059
    2011-01-04    1.477341
    2011-01-05   -0.645279
    2011-01-06    0.352723
    Freq: D, Name: C, dtype: float64




```python
df.iloc[[1,3], [2,3]]  # 提取某几行某几列
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-02</th>
      <td>1.385788</td>
      <td>-0.380398</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>1.477341</td>
      <td>-1.119167</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.iloc[1:3, 2:3]  # 切片
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-02</th>
      <td>1.385788</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.900059</td>
    </tr>
  </tbody>
</table>
</div>



#### 混合使用标签和位置索引, ix() -- 不推荐使用


```python
df.ix[2:5]  # 行
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-03</th>
      <td>-0.855515</td>
      <td>-0.577646</td>
      <td>0.900059</td>
      <td>0.139274</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.135787</td>
      <td>1.031862</td>
      <td>1.477341</td>
      <td>-1.119167</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.991275</td>
      <td>-0.568817</td>
      <td>-0.645279</td>
      <td>0.312290</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.ix[[1,3], 2]
```




    2011-01-02    1.385788
    2011-01-04    1.477341
    Freq: 2D, Name: C, dtype: float64




```python
df.ix[1:3, 2]
```




    2011-01-02    1.385788
    2011-01-03    0.900059
    Freq: D, Name: C, dtype: float64




```python
df.ix[1:3, df.iloc[3]>0]
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-02</th>
      <td>0.390050</td>
      <td>1.385788</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>-0.577646</td>
      <td>0.900059</td>
    </tr>
  </tbody>
</table>
</div>



### DataFrame 操作

#### 转置


```python
df.T
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2011-01-01 00:00:00</th>
      <th>2011-01-02 00:00:00</th>
      <th>2011-01-03 00:00:00</th>
      <th>2011-01-04 00:00:00</th>
      <th>2011-01-05 00:00:00</th>
      <th>2011-01-06 00:00:00</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>-0.660122</td>
      <td>0.483934</td>
      <td>-0.855515</td>
      <td>-0.135787</td>
      <td>-0.991275</td>
      <td>2.430629</td>
    </tr>
    <tr>
      <th>B</th>
      <td>-1.312991</td>
      <td>0.390050</td>
      <td>-0.577646</td>
      <td>1.031862</td>
      <td>-0.568817</td>
      <td>0.070378</td>
    </tr>
    <tr>
      <th>C</th>
      <td>0.843274</td>
      <td>1.385788</td>
      <td>0.900059</td>
      <td>1.477341</td>
      <td>-0.645279</td>
      <td>0.352723</td>
    </tr>
    <tr>
      <th>D</th>
      <td>3.960202</td>
      <td>-0.380398</td>
      <td>0.139274</td>
      <td>-1.119167</td>
      <td>0.312290</td>
      <td>0.165268</td>
    </tr>
  </tbody>
</table>
</div>



#### 排序

* `df.sort_index(axis=0, ascending=True, inplace=False)`

    将 `DataFrame` 按照标签排序 
    * `axis`: 默认为0, 按照 index 排序. 为1时, 按照列名排序

    ```python
    +------------+---------+--------+
    |            |  A      |  B     |
    +------------+---------+---------
    |2011-01-06  | 0.626386| 1.52325|----axis=1----->
    +------------+---------+--------+
                 |         |
                 | axis=0  |
                 ↓         ↓
    ```

    * inplace: 如果 False, 不修改原始数据. 如果 True, 直接修改原始数据


```python
df.sort_index(ascending=False)  
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-06</th>
      <td>2.430629</td>
      <td>0.070378</td>
      <td>0.352723</td>
      <td>0.165268</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.991275</td>
      <td>-0.568817</td>
      <td>-0.645279</td>
      <td>0.312290</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.135787</td>
      <td>1.031862</td>
      <td>1.477341</td>
      <td>-1.119167</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>-0.855515</td>
      <td>-0.577646</td>
      <td>0.900059</td>
      <td>0.139274</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.483934</td>
      <td>0.390050</td>
      <td>1.385788</td>
      <td>-0.380398</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>-0.660122</td>
      <td>-1.312991</td>
      <td>0.843274</td>
      <td>3.960202</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.sort_index(axis=1, ascending=False)  # 注意排序方向
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>D</th>
      <th>C</th>
      <th>B</th>
      <th>A</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>3.960202</td>
      <td>0.843274</td>
      <td>-1.312991</td>
      <td>-0.660122</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>-0.380398</td>
      <td>1.385788</td>
      <td>0.390050</td>
      <td>0.483934</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.139274</td>
      <td>0.900059</td>
      <td>-0.577646</td>
      <td>-0.855515</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-1.119167</td>
      <td>1.477341</td>
      <td>1.031862</td>
      <td>-0.135787</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>0.312290</td>
      <td>-0.645279</td>
      <td>-0.568817</td>
      <td>-0.991275</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>0.165268</td>
      <td>0.352723</td>
      <td>0.070378</td>
      <td>2.430629</td>
    </tr>
  </tbody>
</table>
</div>



* `sort_values(by)` 
根据值排序

> 脑补 `sort_index()` 为 `sort_values(by=index)`


```python
df.sort_values(by='C') 
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>



#### 排名
rank() 返回相应的行或者列排序的排名


```python
df.rank(axis=0)  # 列方向升序排名
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>6.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>5.0</td>
      <td>6.0</td>
      <td>5.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>1.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.rank(axis=0).astype(int)  # 使用 astype 将数据类型变为 int
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>6</td>
      <td>5</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>5</td>
      <td>6</td>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>3</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>2</td>
      <td>3</td>
      <td>6</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.rank(axis=1, ascending=False)  # 行方向降序排名
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>3.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>3.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>1.0</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>4.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>



#### 增加行或者列


```python
s1 = pd.Series([1,2,3,4,5], index=pd.date_range('20110102', periods=5))
s1
```




    2011-01-02    1
    2011-01-03    2
    2011-01-04    3
    2011-01-05    4
    2011-01-06    5
    Freq: D, dtype: int64




```python
df['E'] = s1  # 新增一列
df
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div>



在 df 新增了一列,而且会根据 index 自动对齐


```python
# df = df.loc[:, 'A':'D']
df = df[list('ABCD')]  # 两种方法都可以
df
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.concat([df, df])  # 上下摞起来
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.concat([df, df], axis=1)  # 左右连起来
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>




```python
df1 = pd.DataFrame({'A':[1, 2, 3], 'B':[4, 5, 6], 'C':[7, 8, 9]}, 
                  index=pd.date_range('20110101', periods=3))
df.append(df1)  # 摞起来
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>7.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>2.000000</td>
      <td>5.000000</td>
      <td>8.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>3.000000</td>
      <td>6.000000</td>
      <td>9.000000</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
pd.concat([df, df1], join='inner')
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.334617</td>
      <td>0.701355</td>
      <td>-0.536929</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.393638</td>
      <td>1.034505</td>
      <td>0.249931</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
    </tr>
    <tr>
      <th>2011-01-01</th>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>2.000000</td>
      <td>5.000000</td>
      <td>8.000000</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>3.000000</td>
      <td>6.000000</td>
      <td>9.000000</td>
    </tr>
  </tbody>
</table>
</div>



#### 删除
drop() 返回新的 DataFrame, del 直接在原 DataFrame 上操作


```python
df.drop(dates[1:3])
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.416989</td>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.720014</td>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.330284</td>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>-0.649782</td>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.drop('A', axis=1)
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.724751</td>
      <td>-2.514868</td>
      <td>0.005752</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.701355</td>
      <td>-0.536929</td>
      <td>2.096034</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>1.034505</td>
      <td>0.249931</td>
      <td>0.361379</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>0.208732</td>
      <td>-1.218512</td>
      <td>-0.704865</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-1.442339</td>
      <td>-0.423601</td>
      <td>-0.700278</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>0.454061</td>
      <td>0.336762</td>
      <td>0.724999</td>
    </tr>
  </tbody>
</table>
</div>




```python
df  # 没变
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>-0.660122</td>
      <td>-1.312991</td>
      <td>0.843274</td>
      <td>3.960202</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.483934</td>
      <td>0.390050</td>
      <td>1.385788</td>
      <td>-0.380398</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>-0.855515</td>
      <td>-0.577646</td>
      <td>0.900059</td>
      <td>0.139274</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>-0.135787</td>
      <td>1.031862</td>
      <td>1.477341</td>
      <td>-1.119167</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.991275</td>
      <td>-0.568817</td>
      <td>-0.645279</td>
      <td>0.312290</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>2.430629</td>
      <td>0.070378</td>
      <td>0.352723</td>
      <td>0.165268</td>
    </tr>
  </tbody>
</table>
</div>




```python
del df['A']
df
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>-1.312991</td>
      <td>0.843274</td>
      <td>3.960202</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.390050</td>
      <td>1.385788</td>
      <td>-0.380398</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>-0.577646</td>
      <td>0.900059</td>
      <td>0.139274</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>1.031862</td>
      <td>1.477341</td>
      <td>-1.119167</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.568817</td>
      <td>-0.645279</td>
      <td>0.312290</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>0.070378</td>
      <td>0.352723</td>
      <td>0.165268</td>
    </tr>
  </tbody>
</table>
</div>



#### 替换


```python
df.loc[dates[2], 'C'] = 0
df
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>-1.312991</td>
      <td>0.843274</td>
      <td>3.960202</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.390050</td>
      <td>1.385788</td>
      <td>-0.380398</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>-0.577646</td>
      <td>0.000000</td>
      <td>0.139274</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>1.031862</td>
      <td>1.477341</td>
      <td>-1.119167</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-0.568817</td>
      <td>-0.645279</td>
      <td>0.312290</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>0.070378</td>
      <td>0.352723</td>
      <td>0.165268</td>
    </tr>
  </tbody>
</table>
</div>



#### 重置索引


```python
new_index = pd.date_range('20110101', periods=7)
df.reindex(new_index, columns=list('ABCDE'))
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.558092</td>
      <td>-0.044851</td>
      <td>0.627649</td>
      <td>1.376806</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>2.370370</td>
      <td>0.309665</td>
      <td>1.534129</td>
      <td>0.477640</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>-0.918037</td>
      <td>1.442996</td>
      <td>0.718332</td>
      <td>-0.764125</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>1.232411</td>
      <td>1.239217</td>
      <td>1.380759</td>
      <td>-1.552525</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>-1.157906</td>
      <td>0.486401</td>
      <td>-0.015537</td>
      <td>0.016348</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>2.025508</td>
      <td>1.072081</td>
      <td>-2.053920</td>
      <td>-0.710797</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2011-01-07</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
new_index = pd.date_range('20140101', periods=7)
df.reindex(new_index, columns=list('ABCD'))    # 如果不存在, 那么用 NaN
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-02</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-03</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-04</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-05</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-06</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-07</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



### 轴

参考排序部分

## DataFrame， Series 的运算


#### Series之间的运算
首先根据 index 匹配，无法匹配的话使用 NaN。


```python
s1 = pd.Series([1, 2, 3], index=list('ABC'))
s2 = pd.Series([4, 5, 6], index=list('BCD'))
```


```python
s1 + s2
```




    A    NaN
    B    6.0
    C    8.0
    D    NaN
    dtype: float64



#### DataFrame 与 Series
Series 的 index 与 DataFrame 的 column 匹配。无法匹配的话使用 NaN。


```python
df1 = pd.DataFrame(np.arange(1, 13).reshape(3, 4),
                  index=list('abc'), columns=list('ABCD'))
df1
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>b</th>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>c</th>
      <td>9</td>
      <td>10</td>
      <td>11</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div>




```python
df1 - s1  # 按照
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>4.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



#### DataFrame 之间
根据 index 和 column 匹配。无法匹配的话使用 NaN。


```python
df2 = pd.DataFrame(np.arange(1, 13).reshape(4,3),
                  index=list('bcde'), columns=list('CDE'))
df2
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>c</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
    </tr>
    <tr>
      <th>d</th>
      <td>7</td>
      <td>8</td>
      <td>9</td>
    </tr>
    <tr>
      <th>e</th>
      <td>10</td>
      <td>11</td>
      <td>12</td>
    </tr>
  </tbody>
</table>
</div>




```python
df3 = df1 + df2
df3
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



#### 函数和映射


```python
df = pd.DataFrame(np.random.randn(6, 4), index=dates, columns=list('ABCD'))
df
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01</th>
      <td>0.959872</td>
      <td>0.036688</td>
      <td>-0.495552</td>
      <td>0.350378</td>
    </tr>
    <tr>
      <th>2011-01-02</th>
      <td>0.118525</td>
      <td>0.093901</td>
      <td>1.964353</td>
      <td>0.773641</td>
    </tr>
    <tr>
      <th>2011-01-03</th>
      <td>0.248025</td>
      <td>-0.947414</td>
      <td>1.420396</td>
      <td>0.591633</td>
    </tr>
    <tr>
      <th>2011-01-04</th>
      <td>0.123047</td>
      <td>0.702724</td>
      <td>-2.514727</td>
      <td>0.297213</td>
    </tr>
    <tr>
      <th>2011-01-05</th>
      <td>0.265320</td>
      <td>-0.126869</td>
      <td>0.628532</td>
      <td>0.244290</td>
    </tr>
    <tr>
      <th>2011-01-06</th>
      <td>2.158399</td>
      <td>1.175738</td>
      <td>1.477467</td>
      <td>0.553494</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.apply(max)
```




    A    1.464420
    B    0.836578
    C    1.301486
    D    1.216124
    dtype: float64




```python
df.apply(max, axis=1)
```




    2011-01-01    0.653242
    2011-01-02    0.836578
    2011-01-03    1.301486
    2011-01-04    1.216124
    2011-01-05    1.464420
    2011-01-06    0.467605
    Freq: D, dtype: float64



或者使用自定义函数：


```python
f = lambda x: x.max() - x.min()
df.apply(f)
```




    A    3.148747
    B    2.923576
    C    2.243189
    D    2.499079
    dtype: float64



## 数据规整化


### 判断时候为缺失值 NaN


```python
df3.isnull()
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>b</th>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>c</th>
      <td>True</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>d</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>e</th>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div>




```python
df3.notnull()
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>b</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>c</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>d</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>e</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>



### 选出不是缺失值的数据


```python
df3.C[df3.C.notnull()]
```




    b     8.0
    c    15.0
    Name: C, dtype: float64



### 缺失值的填充

#### 以指定的数字填充


```python
df3.fillna(0)
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>b</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>c</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>d</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>e</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>



#### 以列方向上前一个值填充


```python
df3.fillna(method='ffill')
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



#### 以列方向上后一个值填充


```python
df3.fillna(method='bfill')
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



#### 行方向


```python
df3.fillna(method='bfill', axis=1)
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>15.0</td>
      <td>15.0</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



#### 限定个数


```python
df3.fillna(method='pad', limit=1)
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



### 删除缺失值


```python
df3.dropna(thresh=2)  # 需要多少非 NaN 数据
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
df3.dropna(how='all')
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



### 删除重复数据


```python
df4 = df3.fillna(method='pad')
df4
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>d</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>e</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
df4.duplicated()
```




    a    False
    b    False
    c    False
    d     True
    e     True
    dtype: bool




```python
df4.drop_duplicates()
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
df4.duplicated(['C'])  # 仅仅对某列操作
```




    a    False
    b    False
    c    False
    d     True
    e     True
    dtype: bool




```python
df4.drop_duplicates(['C'])
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>E</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>a</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>b</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>c</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>15.0</td>
      <td>17.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



## 使用 pandas 映射范畴数据

> [MAPPING CATEGORICAL DATA IN PANDAS](http://benalexkeen.com/mapping-categorical-data-in-pandas/)

`Python` 不像 `R`可以使用 `factor` 代表范畴数据. 我们可以使用 `astype('category')` 将范畴数据转变为数字

### Nominal Categories

无序


```python
import pandas as pd

df = pd.DataFrame({'vertebrates': ['Bird', 'Bird', 'Mammal', 'Fish', 'Amphibian', 'Reptile', 'Mammal']})
print(df)

df1 = df.vertebrates.astype("category").cat.codes  # no change for the original df
df1
```

      vertebrates
    0        Bird
    1        Bird
    2      Mammal
    3        Fish
    4   Amphibian
    5     Reptile
    6      Mammal





    0    1
    1    1
    2    3
    3    2
    4    0
    5    4
    6    3
    dtype: int8



#### 指定种类

也可以指定要要转换那些种类, 这样你就很清楚都有什么种类. 任何没有指定的种类都会被标为 **1**. 


```python
vertebrate_types = ['Reptile', 'Bird', 'Amphibian', 'Fish']

df.vertebrates.astype("category", categories=vertebrate_types).cat.codes
```




    0    1
    1    1
    2   -1
    3    3
    4    2
    5    0
    6   -1
    dtype: int8



#### dummes

但是上面这些种类其实和数字是没有关系的, 也就是没有什么大小关系. 那么我们可以将它们转换为 `dummes`.

However, there is no inherent relationship between these categories so it doesn’t necessary make sense to store these as different numbers on the same scale.


```python
pd.get_dummies(df, columns=['vertebrates'])
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vertebrates_Amphibian</th>
      <th>vertebrates_Bird</th>
      <th>vertebrates_Fish</th>
      <th>vertebrates_Mammal</th>
      <th>vertebrates_Reptile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



为了防止 **dummy variable trap**, 使用 `drop_first=True`.


```python
pd.get_dummies(df, columns=['vertebrates'], drop_first=True)
```




<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>vertebrates_Bird</th>
      <th>vertebrates_Fish</th>
      <th>vertebrates_Mammal</th>
      <th>vertebrates_Reptile</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>



### Ordinal Categories

还有很多范畴数据是有序的, 比如成绩的优良中差, 满意度等. 使用 `ordered = True`.


```python
ordered_satisfaction = ['Very Unhappy', 'Unhappy', 'Neutral', 'Happy', 'Very Happy']
df = pd.DataFrame({'satisfaction':['Mad', 'Happy', 'Unhappy', 'Neutral']})
```

可以直接输出文本, 没有的种类为 `NaN`.


```python
df.satisfaction.astype("category",
  ordered=True,
  categories=ordered_satisfaction
)
```




    0        NaN
    1      Happy
    2    Unhappy
    3    Neutral
    Name: satisfaction, dtype: category
    Categories (5, object): [Very Unhappy < Unhappy < Neutral < Happy < Very Happy]



也可以使用数字, 那么没有的就是 **-1**.


```python
df.satisfaction.astype("category",
  ordered=True,
  categories=ordered_satisfaction
).cat.codes
```




    0   -1
    1    3
    2    1
    3    2
    dtype: int8


